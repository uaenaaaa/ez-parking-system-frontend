<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title>Visitor Search</title>
		<style>
			/* General page styling */
			body {
				margin: 0;
				font-family: Arial, sans-serif;
				color: #000;
				background-color: #767184;
			}

			/* Navbar */
			.navbar {
				position: fixed;
				top: 0;
				width: 100%;
				height: 80px;
				background: rgba(217, 217, 217, 0.9);
				display: flex;
				align-items: center;
				padding: 0 20px;
				z-index: 100;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			}

			.navbar .logo {
				display: flex;
				align-items: center;
				margin-right: 20px;
			}

			.navbar .logo img {
				height: 110px;
			}

			/* Search Bar */
			.navbar .search-bar {
				flex-grow: 1;
				max-width: 700px;
				position: relative;
			}

			.navbar .search-bar input[type='text'] {
				width: 100%;
				padding: 12px 18px;
				font-size: 16px;
				border: 1px solid #ccc;
				border-radius: 5px;
				box-sizing: border-box;
			}

			/* Main container */
			.container {
				display: flex;
				height: calc(100vh - 100px);
				margin-top: 80px;
			}

			/* Search Results Section */
			.search-results {
				width: 35%;
				background-color: #d9d9d9;
				overflow-y: auto;
				padding: 15px;
				box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
			}

			.search-results h2 {
				font-size: 22px;
				margin-bottom: 15px;
				color: #333;
			}

			.result-item {
				background-color: white;
				padding: 15px;
				margin-bottom: 10px;
				border-radius: 8px;
				display: flex;
				justify-content: space-between;
				align-items: center;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			}

			.result-item .info h3 {
				font-size: 18px;
				margin: 0;
				color: #333;
			}

			.result-item .info p {
				margin: 5px 0;
				font-size: 14px;
				color: #666;
			}

			.result-item .distance {
				font-size: 12px;
				color: #444;
			}

			.result-item .status {
				color: green;
				font-weight: bold;
				font-size: 12px;
			}

			.directions-button {
				background-color: #8f86a8;
				color: white;
				border: none;
				padding: 8px 12px;
				border-radius: 5px;
				cursor: pointer;
				font-size: 14px;
			}

			/* Map Section */
			.map-container {
				flex-grow: 1;
				position: relative;
			}

			.map {
				width: 100%;
				height: 100%;
				border: none;
			}
		</style>
	</head>
	<body>
		<!-- Navbar -->
		<div class="navbar">
			<div class="logo">
				<img
					src="nearby_logo.png"
					alt="NearbySpot Logo" />
			</div>
			<!-- Search Bar -->
			<div class="search-bar">
				<input
					class="search-input"
					type="text"
					placeholder="Search for parking..." />
			</div>
		</div>

		<!-- Main Container -->
		<div class="container">
			<!-- Search Results Section -->
			<div class="search-results">
				<h2 class="search-term">Parking in BGC</h2>

				<!-- Result 1 -->
				<div class="result-item">
					<div class="info">
						<h3>One Parkade</h3>
						<p>H22X+4WC, Parking Lot</p>
						<p class="status">Open 24 hours</p>
						<p class="distance">2.1 km away</p>
					</div>
					<button
						class="directions-button"
						onclick="openDirections('One Parkade, Bonifacio Global City, Taguig')">
						Directions
					</button>
				</div>

				<!-- Result 2 -->
				<div class="result-item">
					<div class="info">
						<h3>Market Market Parking</h3>
						<p>G3X4+83, Parking Lot</p>
						<p class="status">Open - Closes 9 PM</p>
						<p class="distance">1.8 km away</p>
					</div>
					<button
						class="directions-button"
						onclick="openDirections('Market Market, Bonifacio Global City, Taguig')">
						Directions
					</button>
				</div>
				<!-- Result 3 -->
				<div class="result-item">
					<div class="info">
						<h3>7th Ave Parking</h3>
						<p>G2XW+MWX, 7th Ave</p>
						<p class="status">Open - Closes 12 AM</p>
						<p class="distance">1.5 km away</p>
					</div>
					<button
						class="directions-button"
						onclick="openDirections('7th Ave, Bonifacio Global City, Taguig')">
						Directions
					</button>
				</div>

				<!-- Result 4 -->
				<div class="result-item">
					<div class="info">
						<h3>Gallery Parkade</h3>
						<p>G3X2+98X, 7th Ave</p>
						<p class="status">Open - Closes 12 AM</p>
						<p class="distance">1.2 km away</p>
					</div>
					<button
						class="directions-button"
						onclick="openDirections('Gallery Parkade, Bonifacio Global City, Taguig')">
						Directions
					</button>
				</div>
			</div>

			<!-- Map Section -->
			<div class="map-container">
				<iframe
					class="map"
					src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3859.407731415259!2d121.04902791517263!3d14.552600989827994!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3397c90e30d1c44f%3A0xa217dcff8561d073!2sOne%20Parkade!5e0!3m2!1sen!2sph!4v1614076328908!5m2!1sen!2sph"
					allowfullscreen=""
					loading="lazy"></iframe>
			</div>
		</div>

		<!-- Shape of the data:

        [
    {
        "address": "Novaliches, Quezon City, Metro Manila",
        "closing_time": "23:59:00",
        "contact_number": "09123456789",
        "created_at": "2024-11-06T12:58:41",
        "establishment_id": 2,
        "hourly_rate": 60,
        "is_24_hours": true,
        "latitude": 14.734207,
        "longitude": 121.058511,
        "name": "SM Fairview Novaliches Parking Space",
        "opening_time": "00:00:00",
        "slot_statistics": {
            "occupied_slots": 3,
            "open_slots": 4,
            "reserved_slots": 3,
            "total_slots": 10
        },
        "updated_at": "2024-11-06T12:58:41",
        "uuid": "bff51552af3a4f03a018d440007b8963"
    },
]
        -->

		<script>
			function openDirections(location) {
				const baseUrl =
					'https://www.google.com/maps/dir/?api=1&destination=';
				const query = encodeURIComponent(location);
				window.open(baseUrl + query, '_blank');
			}

			function debounce(func, wait) {
				let timeout;
				return function (...args) {
					clearTimeout(timeout);
					timeout = setTimeout(() => func.apply(this, args), wait);
				};
			}

			const searchInput = document.querySelector('.search-input');
			const searchResultsContainer =
				document.querySelector('.search-results');
			const searchTermElement = document.querySelector('.search-term');

			const updateSearchTerm = function () {
				const searchTerm = this.value;
				searchTermElement.textContent = `Parking in ${searchTerm}`;

				const params = new URLSearchParams({
					establishment_name: searchTerm,
					// latitude: 37.7749,
					// longitude: -122.4194,
					// is_24_hours: true,
					// vehicle_type_id: 1
				});

				fetch(
					`https://127.0.0.1:5000/v1/user/query/establishments?${params.toString()}`,
					{
						method: 'GET',
						headers: {
							'Content-Type': 'application/json',
						},
					},
				)
					.then(function (response) {
						if (response.ok) {
							console.log('Search results fetched successfully');
							return response.json();
						} else {
							console.error(
								'Error fetching search results:',
								response.status,
							);
						}
					})
					.then(function (data) {
						if (data) {
							console.log(data);
							displaySearchResults(data.establishments);
						}
					})
					.catch(function (error) {
						console.error('Error:', error);
					});
			};

			const displaySearchResults = function (establishments) {
				searchResultsContainer.innerHTML =
					'<h2 class="search-term"></h2>';

				establishments.forEach((establishment) => {
					const resultItem = document.createElement('div');
					resultItem.className = 'result-item';

					const infoDiv = document.createElement('div');
					infoDiv.className = 'info';

					const nameElement = document.createElement('h3');
					nameElement.textContent = establishment.name;
					infoDiv.appendChild(nameElement);

					const addressElement = document.createElement('p');
					addressElement.textContent = establishment.address;
					infoDiv.appendChild(addressElement);

					const statusElement = document.createElement('p');
					statusElement.className = 'status';
					statusElement.textContent = establishment.is_24_hours
						? 'Open 24 hours'
						: `Open - Closes at ${establishment.closing_time}`;
					infoDiv.appendChild(statusElement);

					const distanceElement = document.createElement('p');
					distanceElement.className = 'distance';
					distanceElement.textContent = `${calculateDistance(
						establishment.latitude,
						establishment.longitude,
					)} km away`;
					infoDiv.appendChild(distanceElement);

					const directionsButton = document.createElement('button');
					directionsButton.className = 'directions-button';
					directionsButton.textContent = 'Directions';
					directionsButton.onclick = function () {
						openDirections(establishment.address);
					};

					resultItem.appendChild(infoDiv);
					resultItem.appendChild(directionsButton);

					searchResultsContainer.appendChild(resultItem);
				});
			};

			const calculateDistance = function (lat, lon) {
				// Placeholder function to calculate distance
				// Replace with actual distance calculation logic if needed
				return (Math.random() * 10).toFixed(1);
			};

			const debouncedUpdateSearchTerm = debounce(updateSearchTerm, 500);

			searchInput.addEventListener('input', debouncedUpdateSearchTerm);
		</script>
	</body>
</html>
